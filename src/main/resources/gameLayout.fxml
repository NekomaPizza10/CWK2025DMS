<?xml version="1.0" encoding="UTF-8"?>

<?import com.comp2042.ui.GameOverPanel?>
<?import com.comp2042.ui.PauseMenuPanel?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.Group?>
<?import javafx.scene.layout.*?>
<?import java.net.URL?>
<?import javafx.geometry.Insets?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.comp2042.ui.GuiController"
           prefHeight="700" prefWidth="900"
           style="-fx-background-color: #1a1a1a;">

    <!-- Main Game Layout -->
    <BorderPane>
        <center>
            <HBox alignment="CENTER" spacing="20">
                <!-- Left Side: HOLD Box + Score/Best Panels -->
                <VBox alignment="TOP_CENTER" spacing="15" minWidth="160" style="-fx-background-color: transparent;">
                    <padding>
                        <Insets top="50"/>
                    </padding>

                    <!-- HOLD Panel -->
                    <VBox minWidth="80" style="-fx-background-color: #000000; -fx-border-color: #ffffff; -fx-border-width: 3;">
                        <padding>
                            <Insets top="5" right="5" bottom="1" left="5"/>
                        </padding>
                        <Label text="HOLD" style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold; -fx-alignment: center;" maxWidth="Infinity">
                            <padding>
                                <Insets bottom="1"/>
                            </padding>
                        </Label>

                        <Region prefHeight="1" style="-fx-background-color: #333333;">
                            <VBox.margin><Insets top="5" bottom="5"/></VBox.margin>
                        </Region>

                        <StackPane prefWidth="60" prefHeight="60" minWidth="60" minHeight="60" style="-fx-background-color: #000000;" alignment="CENTER">
                            <GridPane fx:id="holdPanel" hgap="0" vgap="0" alignment="CENTER"/>
                        </StackPane>
                    </VBox>

                    <!-- Stats Panel (Left Side) -->
                    <VBox alignment="TOP_LEFT" spacing="15" minWidth="140" style="-fx-padding: 20; -fx-background-color: rgba(0,0,0,0.5); -fx-background-radius: 5;">
                        <VBox spacing="5">
                            <Label fx:id="piecesLabel" text="PIECES" alignment="CENTER"
                                   style="-fx-text-fill: #888888; -fx-font-size: 12px; -fx-font-weight: bold;"/>
                            <Label fx:id="piecesValue" text="0" alignment="CENTER" minWidth="100"
                                   style="-fx-text-fill: white; -fx-font-size: 28px; -fx-font-weight: bold;"/>
                        </VBox>

                        <VBox spacing="5">
                            <Label fx:id="linesLabel" text="LINES" alignment="CENTER"
                                   style="-fx-text-fill: #888888; -fx-font-size: 12px; -fx-font-weight: bold;"/>
                            <Label fx:id="linesValue" text="0" alignment="CENTER" minWidth="100"
                                   style="-fx-text-fill: white; -fx-font-size: 28px; -fx-font-weight: bold;"/>
                        </VBox>

                        <VBox spacing="5">
                            <Label fx:id="timeLabel" text="TIME"
                                   style="-fx-text-fill: #888888; -fx-font-size: 12px; -fx-font-weight: bold;"/>
                            <Label fx:id="timeValue" text="0:00.000" minWidth="120"
                                   style="-fx-text-fill: white; -fx-font-size: 28px; -fx-font-weight: bold;"/>
                        </VBox>
                    </VBox>

                    <!-- SCORE/BEST DISPLAY (Moved to Left Side) -->
                    <VBox fx:id="scoreDisplayContainer" alignment="CENTER" spacing="10" minWidth="140"
                          style="-fx-background-color: rgba(0,0,0,0.6);
                               -fx-padding: 15;
                                 -fx-background-radius: 5;
                               -fx-border-color: rgba(255,255,255,0.1);
                               -fx-border-width: 1;
                               -fx-border-radius: 5;">

                        <!-- Best Time (40-Lines mode only) - AT TOP -->
                        <VBox fx:id="bestTimeBox" alignment="CENTER" spacing="3"
                              visible="false" managed="false">
                            <Label text="BEST TIME"
                                   style="-fx-text-fill: #ff9900; -fx-font-size: 13px; -fx-font-weight: bold; -fx-letter-spacing: 1;"/>
                            <Label fx:id="bestTimeLabel" text="--:--" minWidth="100"
                                   style="-fx-text-fill: #ff9900; -fx-font-size: 28px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- Score (Normal & 2-Min modes) -->
                        <VBox fx:id="scoreBox"
                              alignment="CENTER"
                              prefHeight="40"
                              minHeight="40"
                              maxHeight="40"
                              spacing="3"
                              managed="true">
                            <Label fx:id="scoreLabel" text="SCORE"
                                   style="-fx-text-fill: #00aaff; -fx-font-size: 12px; -fx-font-weight: bold; -fx-letter-spacing: 1;"/>
                            <Label fx:id="scoreValue" text="0" alignment="CENTER" minWidth="100"
                                   style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                        </VBox>

                        <!-- Separator (only visible in 2-min mode) -->
                        <Region fx:id="scoreSeparator" prefHeight="1"
                                style="-fx-background-color: rgba(255,255,255,0.2);"
                                maxWidth="120" visible="false" managed="false"/>

                        <!-- Best Score (2-Min mode only) -->
                        <VBox fx:id="bestScoreBox"
                              alignment="CENTER"
                              prefHeight="40"
                              minHeight="40"
                              maxHeight="40"
                              spacing="3"
                              visible="false" managed="false">
                            <Label fx:id="bestScoreLabel" text="BEST"
                                   style="-fx-text-fill: #ffaa00; -fx-font-size: 12px; -fx-font-weight: bold; -fx-letter-spacing: 1;"/>
                            <Label fx:id="bestScoreValue" text="--" minWidth="100"
                                   style="-fx-text-fill: #ffaa00; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                        </VBox>
                    </VBox>
                </VBox>

                <!-- Center: Game Board -->
                <VBox alignment="CENTER">
                    <StackPane alignment="CENTER" style="-fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 20, 0, 0, 0);">
                        <VBox prefWidth="250" prefHeight="625"
                              style="-fx-border-color: #ffffff; -fx-border-width: 2; -fx-background-color: #000000; -fx-padding: 0;">
                            <StackPane alignment="TOP_LEFT">
                                <GridPane fx:id="gamePanel"
                                          alignment="CENTER"
                                          hgap="0" vgap="0"
                                          style="-fx-background-color: #000000;"/>

                                <Pane fx:id="brickPaneContainer"
                                      prefWidth="250" prefHeight="625"
                                      minWidth="250" minHeight="625"
                                      maxWidth="250" maxHeight="625"
                                      style="-fx-background-color: transparent;"
                                      mouseTransparent="true">
                                    <GridPane fx:id="brickPanel" hgap="0" vgap="0"/>
                                </Pane>

                                <StackPane fx:id="countdownPanel"
                                           visible="false"
                                           style="-fx-background-color: rgba(0, 0, 0, 0.8);"
                                           alignment="CENTER">
                                    <Label fx:id="countdownLabel"
                                           style="-fx-text-fill: white;
                                                  -fx-font-size: 80px;
                                                  -fx-font-weight: bold;
                                                  -fx-effect: dropshadow(gaussian, black, 20, 0.5, 0, 0);"/>
                                </StackPane>
                            </StackPane>
                        </VBox>
                    </StackPane>
                </VBox>

                <!-- Right Side: NEXT Box Only -->
                <VBox alignment="TOP_CENTER" spacing="10" minWidth="120" style="-fx-background-color: transparent;">
                    <padding>
                        <Insets top="50"/>
                    </padding>

                    <!-- NEXT Panel -->
                    <VBox minWidth="100" style="-fx-background-color: #000000; -fx-border-color: #ffffff; -fx-border-width: 3;">
                        <padding>
                            <Insets top="5" right="10" bottom="5" left="10"/>
                        </padding>
                        <Label text="NEXT" style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold; -fx-alignment: center;" maxWidth="Infinity">
                            <padding>
                                <Insets bottom="5"/>
                            </padding>
                        </Label>

                        <Region prefHeight="1" style="-fx-background-color: #333333;">
                            <VBox.margin><Insets top="5" bottom="5"/></VBox.margin>
                        </Region>

                        <StackPane prefWidth="100" prefHeight="60" minWidth="80" minHeight="60" style="-fx-background-color: #000000;" alignment="CENTER">
                            <GridPane fx:id="nextPanel1" hgap="0" vgap="0" alignment="CENTER"/>
                        </StackPane>

                        <Region prefHeight="1" style="-fx-background-color: #333333;">
                            <VBox.margin><Insets top="2" bottom="2"/></VBox.margin>
                        </Region>

                        <StackPane prefWidth="100" prefHeight="60" minWidth="80" minHeight="60" style="-fx-background-color: #000000;" alignment="CENTER">
                            <GridPane fx:id="nextPanel2" hgap="0" vgap="0" alignment="CENTER"/>
                        </StackPane>
                        <Region prefHeight="1" style="-fx-background-color: #333333;">
                            <VBox.margin><Insets top="2" bottom="2"/></VBox.margin>
                        </Region>

                        <StackPane prefWidth="100" prefHeight="60" minWidth="80" minHeight="60" style="-fx-background-color: #000000;" alignment="CENTER">
                            <GridPane fx:id="nextPanel3" hgap="0" vgap="0" alignment="CENTER"/>
                        </StackPane>
                        <Region prefHeight="1" style="-fx-background-color: #333333;">
                            <VBox.margin><Insets top="2" bottom="2"/></VBox.margin>
                        </Region>

                        <StackPane prefWidth="100" prefHeight="60" minWidth="80" minHeight="60" style="-fx-background-color: #000000;" alignment="CENTER">
                            <GridPane fx:id="nextPanel4" hgap="0" vgap="0" alignment="CENTER"/>
                        </StackPane>
                        <Region prefHeight="1" style="-fx-background-color: #333333;">
                            <VBox.margin><Insets top="2" bottom="2"/></VBox.margin>
                        </Region>

                        <StackPane prefWidth="100" prefHeight="60" minWidth="80" minHeight="60" style="-fx-background-color: #000000;" alignment="CENTER">
                            <GridPane fx:id="nextPanel5" hgap="0" vgap="0" alignment="CENTER"/>
                        </StackPane>
                    </VBox>
                </VBox>
            </HBox>
        </center>

        <stylesheets>
            <URL value="@window_style.css"/>
        </stylesheets>
    </BorderPane>

    <PauseMenuPanel fx:id="pauseMenuPanel" visible="false"/>
    <GameOverPanel fx:id="gameOverPanel" visible="false"/>

</StackPane>