<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>
<?import com.comp2042.ui.effect.ComboMeterPanel?>
<?import com.comp2042.ui.panel.GameOverPanel?>
<?import com.comp2042.ui.panel.PauseMenuPanel?>

<StackPane xmlns:fx="http://javafx.com/fxml"
           stylesheets="game-style.css"
           fx:id="rootPane"
           fx:controller="com.comp2042.ui.initialization.GuiController"
           prefWidth="700" prefHeight="900"
           style="-fx-background-color: linear-gradient(to bottom, #0f0f23, #1a1a2e, #16213e);">

    <!-- ==================== MAIN GAME CONTENT ==================== -->
    <HBox alignment="CENTER" spacing="5">

        <!-- ========== LEFT SIDE: Hold + Stats ========== -->
        <VBox alignment="TOP_CENTER" spacing="10" minWidth="120" maxWidth="120">
            <padding><Insets top="20" right="5" bottom="20" left="10"/></padding>

            <!-- Hold Panel -->
            <VBox alignment="CENTER" spacing="5"
                  style="-fx-background-color: rgba(0,0,0,0.6); -fx-background-radius: 10; -fx-padding: 12;">
                <Label text="HOLD" style="-fx-text-fill: #888888; -fx-font-size: 12px; -fx-font-weight: bold;"/>
                <StackPane prefWidth="90" prefHeight="90" style="-fx-background-color: rgba(0,0,0,0.4); -fx-background-radius: 5;">
                    <GridPane fx:id="holdPanel" alignment="CENTER" hgap="0" vgap="0"/>
                </StackPane>
            </VBox>

            <!-- Spacer -->
            <Region VBox.vgrow="ALWAYS" minHeight="20"/>

            <!-- Stats Display -->
            <VBox fx:id="scoreDisplayContainer" alignment="CENTER" spacing="8"
                  style="-fx-background-color: rgba(0,0,0,0.5); -fx-background-radius: 8; -fx-padding: 12;">

                <!-- Score -->
                <VBox fx:id="scoreBox" alignment="CENTER" spacing="2">
                    <Label text="SCORE" style="-fx-text-fill: #888888; -fx-font-size: 15px; -fx-font-weight: bold;"/>
                    <Label fx:id="scoreValue" text="0" style="-fx-text-fill: #ffffff; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                </VBox>

                <Region fx:id="scoreSeparator" prefHeight="1" prefWidth="60"
                        style="-fx-background-color: #444444;"/>

                <!-- Best Score -->
                <VBox fx:id="bestScoreBox" alignment="CENTER" spacing="2">
                    <Label text="BEST" style="-fx-text-fill: #888888; -fx-font-size: 15px; -fx-font-weight: bold;"/>
                    <Label fx:id="bestScoreValue" text="0" style="-fx-text-fill: #aaaaaa; -fx-font-size: 14px; -fx-font-weight: bold;"/>
                </VBox>

                <!-- Best Time (for 40 Lines mode) -->
                <VBox fx:id="bestTimeBox" alignment="CENTER" spacing="2" visible="false" managed="false">
                    <Label text="BEST TIME" style="-fx-text-fill: #888888; -fx-font-size: 15px; -fx-font-weight: bold;"/>
                    <Label fx:id="bestTimeLabel" text="--:--" style="-fx-text-fill: #aaaaaa; -fx-font-size: 14px; -fx-font-weight: bold;"/>
                </VBox>

            </VBox>

            <!-- Pieces & Lines -->
            <VBox alignment="CENTER" spacing="6"
                  style="-fx-background-color: rgba(0,0,0,0.5); -fx-background-radius: 8; -fx-padding: 10;">

                <HBox alignment="CENTER" spacing="5">
                    <Label text="PIECES" style="-fx-text-fill: #888888; -fx-font-size: 15px;"/>
                    <Label fx:id="piecesValue" text="0" style="-fx-text-fill: #ffffff; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                </HBox>

                <HBox alignment="CENTER" spacing="5">
                    <Label fx:id="linesLabel" text="LINES" style="-fx-text-fill: #888888; -fx-font-size: 15px;"/>
                    <Label fx:id="linesValue" text="0" style="-fx-text-fill: #ffffff; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                </HBox>

            </VBox>

            <!-- Timer -->
            <VBox alignment="CENTER" spacing="3"
                  style="-fx-background-color: rgba(0,0,0,0.5); -fx-background-radius: 8; -fx-padding: 8;">
                <Label fx:id="timeLabel" text="TIME" style="-fx-text-fill: #888888; -fx-font-size: 14px;"/>
                <Label fx:id="timeValue" text="0:00" style="-fx-text-fill: #ffffff; -fx-font-size: 15px; -fx-font-weight: bold;"/>
            </VBox>

        </VBox>

        <!-- ========== CENTER: Game Board ========== -->
        <StackPane fx:id="gameBoardContainer" alignment="CENTER" maxWidth="-Infinity" maxHeight="-Infinity">

            <!-- Game Grid -->
            <GridPane fx:id="gamePanel" alignment="CENTER" hgap="0" vgap="0"
                      style="-fx-background-color: rgba(0,0,0,0.7); -fx-border-color: #333333; -fx-border-width: 2;"/>

            <!-- Brick Panel (current piece) -->
            <GridPane fx:id="brickPanel" alignment="CENTER" hgap="0" vgap="0"
                      mouseTransparent="true" pickOnBounds="false"/>

            <!-- Effects Layer (combo text, etc.) -->
            <Pane fx:id="effectsLayer" mouseTransparent="true" pickOnBounds="false"/>

        </StackPane>

        <!-- ========== RIGHT SIDE: Next Panels + Combo Meter ========== -->
        <HBox alignment="TOP_CENTER" spacing="6">
            <padding><Insets top="20" right="10" bottom="20" left="5"/></padding>

            <!-- Next Panels -->
            <VBox alignment="TOP_CENTER" spacing="8" minWidth="95" maxWidth="95">

                <!-- Next Label -->
                <Label text="NEXT" style="-fx-text-fill: #888888; -fx-font-size: 12px; -fx-font-weight: bold;"/>

                <!-- Next Panel 1 (largest) -->
                <StackPane style="-fx-background-color: rgba(0,0,0,0.6); -fx-background-radius: 8; -fx-padding: 8;">
                    <VBox alignment="CENTER" prefWidth="80" prefHeight="80">
                        <GridPane fx:id="nextPanel1" alignment="CENTER" hgap="0" vgap="0"/>
                    </VBox>
                </StackPane>

                <!-- Next Panel 2 - FIXED -->
                <StackPane style="-fx-background-color: rgba(0,0,0,0.5); -fx-background-radius: 7; -fx-padding: 6;">
                    <VBox alignment="CENTER" prefWidth="70" prefHeight="70">
                        <GridPane fx:id="nextPanel2" alignment="CENTER" hgap="0" vgap="0"/>
                    </VBox>
                </StackPane>

                <!-- Next Panel 3 - FIXED -->
                <StackPane style="-fx-background-color: rgba(0,0,0,0.4); -fx-background-radius: 6; -fx-padding: 5;">
                    <VBox alignment="CENTER" prefWidth="60" prefHeight="60">
                        <GridPane fx:id="nextPanel3" alignment="CENTER" hgap="0" vgap="0"/>
                    </VBox>
                </StackPane>

                <!-- Next Panel 4 - FIXED -->
                <StackPane style="-fx-background-color: rgba(0,0,0,0.35); -fx-background-radius: 5; -fx-padding: 4;">
                    <VBox alignment="CENTER" prefWidth="55" prefHeight="55">
                        <GridPane fx:id="nextPanel4" alignment="CENTER" hgap="0" vgap="0"/>
                    </VBox>
                </StackPane>

                <!-- Next Panel 5 - FIXED -->
                <StackPane style="-fx-background-color: rgba(0,0,0,0.3); -fx-background-radius: 5; -fx-padding: 4;">
                    <VBox alignment="CENTER" prefWidth="50" prefHeight="50">
                        <GridPane fx:id="nextPanel5" alignment="CENTER" hgap="0" vgap="0"/>
                    </VBox>
                </StackPane>

            </VBox>

            <!-- Combo Meter -->
            <ComboMeterPanel fx:id="comboMeterPanel"/>

        </HBox>

    </HBox>

    <!-- ==================== OVERLAYS ==================== -->

    <!-- Countdown Panel -->
    <StackPane fx:id="countdownPanel" visible="false"
               style="-fx-background-color: rgba(0,0,0,0.7);">
        <Label fx:id="countdownLabel" text="3"
               style="-fx-text-fill: white; -fx-font-size: 72px; -fx-font-weight: bold;"/>
    </StackPane>

    <!-- Game Over Panel -->
    <GameOverPanel fx:id="gameOverPanel" visible="false"/>

    <!-- Pause Menu Panel -->
    <PauseMenuPanel fx:id="pauseMenuPanel" visible="false"/>

</StackPane>